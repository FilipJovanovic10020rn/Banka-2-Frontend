<div class="body-container">

  <p-breadcrumb [model]="breadcrumbItems"></p-breadcrumb>

    <div class="table-container">
      <p-table [value]="futures" class="p-datatable-header"
              [rowHover]="true" [rows] ="6" [showCurrentPageReport]="true"
              [paginator]="true" [alwaysShowPaginator]="false"
              [loading]="loading" [loadingIcon]="''"
              currentPageReportTemplate="Prikazani su {first}-{last} od ukupno {totalRecords} terminskih ugovora" >

        <ng-template pTemplate="caption">

          <div class="table-header row">
            <div class="col-6 text-start table-name">
              <div style="display:flex; align-items: center; gap: 8px;">
                <h3 class="berza-mojeakcije-text">
                  Terminski ugovori
                </h3>

               <p-inputSwitch [(ngModel)]="changeOption"
                (ngModelChange)="changeFuturesForShow()"  class="custom-input-switch"></p-inputSwitch>

                <h3 class="berza-mojeakcije-text">
                  Moji terminski ugovori
                </h3>
              </div>
            </div>

          </div>
        </ng-template>

        <ng-template pTemplate="header">
          <tr *ngIf="!changeOption">
            <th>
              <p style="margin-bottom: 0; margin-top: 2px;">Naziv</p>
            </th>
            <th>
              <p style="margin-bottom: 0; margin-top: 2px;">Vlasnik</p>
            </th>
            <th pSortableColumn="maintenanceMargin" style="font-size: 12px; ">
              <div class="flex justify-content-between align-items-center">
                <div class="icon-container">
                  <p style="margin-bottom: 0; margin-top: 2px;">Cena</p>
                  <p-sortIcon field="maintenanceMargin"></p-sortIcon>
                </div>
              </div>
            </th>
            <th pSortableColumn="settlementDate" style="font-size: 12px; ">
              <div class="flex justify-content-between align-items-center">
                <div class="icon-container">
                  <p style="margin-bottom: 0; margin-top: 2px;">Datum</p>
                  <p-sortIcon field="settlementDate"></p-sortIcon>
                </div>
              </div>
            </th>
            <th>
              <p style="margin-bottom: 0; margin-top: 2px;">Opcije</p>
            </th>
          </tr>
          <tr *ngIf="changeOption">
            <th>
              <p style="margin-bottom: 0; margin-top: 2px;">Naziv</p>
            </th>
            <!-- <th>
              <p style="margin-bottom: 0; margin-top: 2px;">Vlasnik</p>
            </th> -->
            <th>
              <p style="margin-bottom: 0; margin-top: 2px;">Na prodaji</p>
            </th>
            <th pSortableColumn="maintenanceMargin" style="font-size: 12px; ">
              <div class="flex justify-content-between align-items-center">
                <div class="icon-container">
                  <p style="margin-bottom: 0; margin-top: 2px;">Cena</p>
                  <p-sortIcon field="maintenanceMargin"></p-sortIcon>
                </div>
              </div>
            </th>
            <th pSortableColumn="settlementDate" style="font-size: 12px; ">
              <div class="flex justify-content-between align-items-center">
                <div class="icon-container">
                  <p style="margin-bottom: 0; margin-top: 2px;">Datum</p>
                  <p-sortIcon field="settlementDate"></p-sortIcon>
                </div>
              </div>
            </th>
            <th>
              <p style="margin-bottom: 0; margin-top: 2px;">Opcije</p>
            </th>
          </tr>
        </ng-template>

        <ng-template pTemplate="loadingbody">
          <tr>
            <td><p-skeleton width="3rem"></p-skeleton></td>
            <td><p-skeleton width="3rem" styleClass="mb-2"></p-skeleton></td>
            <td><p-skeleton width="3rem" styleClass="mb-2"></p-skeleton></td>
            <td><p-skeleton width="3rem" styleClass="mb-2"></p-skeleton></td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <!-- TODO centrirati ovo u tabelu -->
            <td [attr.colspan]="7">
              <div class="text-center">
                <span *ngIf="!changeOption" >Nema podataka za prikazivanje</span>
                <!-- <span *ngIf="(BuySellOption && stocks-table)">Nema hartije koju trazite</span> -->
                <span *ngIf="changeOption" >Nemate kupljenih terminskih ugovora za prikazivanje</span>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-future>
          <tr *ngIf="!changeOption">

            <td>{{future.futureName}}</td>
            <td *ngIf="future.user">{{future.user.firstName + ' ' + future.user.lastName }}</td>
            <td *ngIf="!future.user">Nema vlasnika</td>

            <td>{{future.maintenanceMargin}}</td>
            <td>{{future.settlementDate}}</td>
            <td>
              <button *ngIf="!changeOption" (click)="buyFuture(future)" pButton label="Kupi"></button>
              <button *ngIf="changeOption"  (click)="buyWithLimit()" pButton label="Kupi sa limitom"></button>
            </td>
          </tr>
          <tr *ngIf="changeOption">

            <td>{{future.futureName}}</td>
            <!-- <td *ngIf="future.user">{{future.user.id}}</td>
            <td *ngIf="!future.user">Nema vlasnika</td> -->

            <td *ngIf="future.forSale">Na prodaju</td>
            <td *ngIf="!future.forSale">Nije na prodaju</td>

            <td>{{future.maintenanceMargin}}</td>
            <td>{{future.settlementDate}}</td>
            <td>
              <div *ngIf="checkIfFutureIsWaiting(future.id)">
                <button *ngIf="changeOption && !future.forSale" (click)="openSellFutureDialog(future)" pButton label="Prodja"></button>
                <button *ngIf="changeOption && !future.forSale" (click)="openSellFutureWithLimitDialog(future)" pButton label="Prodaj sa limitom"></button>
                <button *ngIf="changeOption && future.forSale" (click)="removeFromMarket(future.id)" pButton label="Skini"></button>
              </div>
              <div *ngIf="!checkIfFutureIsWaiting(future.id)">
                <button (click)="removeFutureFromWaitingToBeSold(future.id)" pButton label="Skini sa cekanja"></button>
              </div>
            </td>
          </tr>
        </ng-template>

      </p-table>
    </div>
</div>

<app-sell-future (futureSoldEmitter)="sellFuture($event)"></app-sell-future>
<app-sell-future-with-limit (futureSoldEmitter)="sellFutureWithLimit($event)"></app-sell-future-with-limit>
